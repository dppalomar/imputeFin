---
title: "Imputation for AR Time Series"
author: |
  | Junyan Liu and Daniel P. Palomar
  | Hong Kong University of Science and Technology (HKUST)
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    base_format: prettydoc::html_pretty
    theme: tactile
    highlight: vignette
    fig_caption: yes
    number_sections: no
    toc: yes
    toc_depth: 2
  bookdown::pdf_document2:
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_depth: 2
header-includes:
  \allowdisplaybreaks
indent: yes
csl: ieee.csl
bibliography: refs.bib
vignette: >
  %\VignetteIndexEntry{Imputation AR time series}
  %\VignetteKeyword{imputation, AR time series}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, echo = FALSE}
library(knitr)
opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center",
  fig.retina = 2,
  out.width = "75%",
  dpi = 96
)
knit_hooks$set(pngquant = hook_pngquant)
#Help on bookdown: https://bookdown.org/yihui/bookdown/
#rmarkdown::render("vignettes/ImputeFin-vignette.Rmd", "all")
#rmarkdown::render("vignettes/ImputeFin-vignette.Rmd", "bookdown::html_document2")
#rmarkdown::render("vignettes/ImputeFin-vignette.Rmd", "bookdown::pdf_document2")
#tools::compactPDF("vignettes/ImputeFin-vignette.pdf", gs_quality = "ebook")
```

-----------
> This vignette illustrates the usage of the package `imputeFin` for imputation of missing Values in  incomplete AR time series. 

# Installation
The package can currently be installed from [GitHub](https://github.com/dppalomar/imputeFin):
```{r, eval = FALSE}
# install.packages("devtools")
devtools::install_github("dppalomar/imputeFin")
# Getting help
library(imputeFin)
help(package = "imputeFin")
package?imputeFin
?imputeFin
```

# Usage of the package
## Estimation and imputation for univariate incomplete Gaussian AR(1) time series
We start by loading the package:
```{r, message = FALSE}
library(imputeFin)
```

We download the adjusted price of S&P 500 index from 2012-01-01 to 2015-07-08, and compute the log prices. We delete some log prices to generate missing values.

```{r, message = FALSE}
library(xts)
library(quantmod)
y_orig <- log(Ad(getSymbols("^GSPC", from = "2012-01-01", to = "2015-07-08", auto.assign = FALSE)))
n <- nrow(y_orig)
miss_pct <- 0.2 # the percentage of missing values
n_miss <- floor(miss_pct*n)
index_miss <- round(n/2) + 1:n_miss
y <- y_orig
y[index_miss] <- NA
```

Then we use the function `estimateAR1Gaussian()` to estimate the parameters of Gaussian AR(1) model from this incomplete time series.

```{r, message = FALSE}
library(tictoc)
tic("parameter estimation")
estimation_result <- estimateAR1Gaussian(y)
toc()
estimation_result$phi0
estimation_result$phi1
estimation_result$sigma2
```

Next, we use the function `imputeAR1Gaussian()` to impute the missing values in the incomplete time series.
 
```{r}
# we generate n_sample = 2 imputed time series
tic("imputation of missing values with unknown parameters")
imputation_result <- imputeAR1Gaussian(y, n_sample = 2)
toc()

y_imputed <- xts(imputation_result$y_imputed, index(y))
index_miss_bis <- (min(index_miss)-1):(max(index_miss)+1)
{ plot(y, main = "original")
  lines(y_orig[index_miss_bis, 1], col="blue", lwd=2) }  # plot the original time series
{ plot(y, main="Imputed")
  lines(y_imputed[index_miss_bis, 1], col="blue", lwd=2) }#plot the first imputed time series
{ plot(y, main="Imputed")
  lines(y_imputed[index_miss_bis, 2], col="blue", lwd=2) }#plot the second imputed time series

# if we have already known the parameters, then we can use this information when doing the imputation.
param = list("phi0" = estimation_result$phi0,
             "phi1" = estimation_result$phi1,
             "sigma2" = estimation_result$sigma2)

tic("imputation of missing values with known parameters")
imputation_result <- imputeAR1Gaussian(y, n_sample = 2)
toc()
```

# Comparison with other packages
We compare with the existing package `imputeTS`. 

```{r}
# impute using package imputeTS 
library("imputeTS")
y_imputed_km = na.kalman(y)
{ plot(y, main="Imputed by package imputeTS")
  lines(y_imputed_km[index_miss_bis], col="blue", lwd=2) }#plot the second imputed time series
```
